\section{Clúster final}
Veient les opcions presentades en les seccions anteriors,  hem decidit escollir la versió que ens dóna més TFlops. Aquesta és la que té nodes dual-socket amb el processador \textit{AMD EPYC 7502}. Hem escollit comprar els commutadors de 40 ports, ja que ens ofereixen el doble de velocitat que els de 36 (200 Gbits i 100 Gbits respectivament).

Podem veure que el percentatge de TFlops de les gràfiques respecte el total és 0.289. Aquest número s'aconsegueix amb 12 GPUs \textit{AMD Radeon Instinc MI50}, posant 6 en dos nodes. Com els nodes tenen 8 slots per gràfiques (PCIe de 16 lanes), podríem afegir 4 targetes gràfiques amb menys TFlops i intentar apropar-nos més al 30\% de TFlops de GPU que ens imposa la restricció.

Per fer-ho, afegim quatre gràfiques \textit{AMD Radeon Pro WX8200}, afegint 2.625 TFlops al nostre clúster. El preu s'incrementa en 3879.96 \$ i el ràtio de \texttt{TFlops GPU/Total} acaba sent 0.296.

Per calcular el consum de potència, hem tingut en compte els següents valors (aproximant aquells dels que no trobàvem dades concretes)
\begin{table}[h!]
\centering
\begin{tabular}{ll}
\hline
\multicolumn{1}{|l|}{Nom}         & \multicolumn{1}{l|}{Consum (W)} \\ \hline
\multicolumn{1}{|l|}{CPUs}        & \multicolumn{1}{l|}{56880}      \\ \hline
\multicolumn{1}{|l|}{\begin{tabular}[c]{@{}l@{}}GPUs \\ Instinct\end{tabular}} & \multicolumn{1}{l|}{3600} \\ \hline
\multicolumn{1}{|l|}{\begin{tabular}[c]{@{}l@{}}GPUs \\ Pro\end{tabular}}      & \multicolumn{1}{l|}{920}  \\ \hline
\multicolumn{1}{|l|}{Memòria\cite{consummem}}     & \multicolumn{1}{l|}{3792}       \\ \hline
\multicolumn{1}{|l|}{Commutadors\cite{consumnintendo}} & \multicolumn{1}{l|}{500}        \\ \hline
\multicolumn{1}{|l|}{Total}       & \multicolumn{1}{l|}{65692}      \\ \hline
                                  &                                
\end{tabular}
\caption{Càlcul de potència}
\end{table}


\clearpage

Finalment, aquesta és la configuració que hem escollit:
\begin{table}[H]
\begin{adjustwidth}{-1.0in}{-1.0in}
\begin{center}
\begin{tabular}{l|l}
\hline
    {\cellcolor[HTML]{EFEFEF}CPU}         & {\cellcolor[HTML]{EFEFEF}Dual-socket AMD EPYC Rome 7502P \cite{cpu_amd_7502_buy}} \\ 
    Cores/CPU & 32 \\
    \rowcolor[HTML]{EFEFEF}
    Placa base & AMD EPYC 7002 series, dual-socket \cite{} TODO \\
Cores/Node                                       & 64                                             \\ 
    {\cellcolor[HTML]{EFEFEF}GPU\_1}                       & {\cellcolor[HTML]{EFEFEF}AMD Radeon Instinct MI50 \cite{gpu_mi50}} \\ 
\#GPU\_1                                           & 12 (2 nodes amb 6 GPUs)                         \\
    {\cellcolor[HTML]{EFEFEF}GPU\_2}                       & {\cellcolor[HTML]{EFEFEF}AMD Radeon Pro WX8200 \cite{gpu_pro_8200}} \\ 
\#GPU\_2                                           & 4 (2 nodes amb 2 GPUs)                         \\
    {\cellcolor[HTML]{EFEFEF}Memòria}     & {\cellcolor[HTML]{EFEFEF}Kingston KSM29RS4 DDR4 2933Hz \cite{mem2}}   \\
{\color[HTML]{000000}Memòries/node}             & {\color[HTML]{000000}8 DIMMS de 16GB}          \\ 
    {\cellcolor[HTML]{EFEFEF}Commutadors} & {\cellcolor[HTML]{EFEFEF}Mellanox MQM8700-HS2F, 200Gbits \cite{mellanox_mqm8700-hs2f}} \\ 
{\color[HTML]{000000}\#Commutadors}             & {\color[HTML]{000000}3}                        \\ 
{\cellcolor[HTML]{EFEFEF}\#Nodes sense GPU (1U)}    & {\cellcolor[HTML]{EFEFEF}77}                       \\
{\color[HTML]{000000}\#Nodes amb GPU (2U)}      & {\color[HTML]{000000}2}                        \\
{\cellcolor[HTML]{EFEFEF}Us de nodes}               & {\cellcolor[HTML]{EFEFEF}81}                       \\
{\color[HTML]{000000}Us de nodes + commutadors} & {\color[HTML]{000000}84}                       \\ \hline
{\cellcolor[HTML]{EFEFEF}TFlops CPU}                & {\cellcolor[HTML]{EFEFEF}197.5}                    \\
{\color[HTML]{000000}TFlops GPU}                & {\color[HTML]{000000}83.085}                    \\ 
{\cellcolor[HTML]{EFEFEF}TFlops Totals}             & {\cellcolor[HTML]{EFEFEF}280.585}                   \\ 
{\color[HTML]{000000}TFlops GPU/Totals}         & {\color[HTML]{000000} 0.296}                    \\ 
{\cellcolor[HTML]{EFEFEF}Cost (Dòllars)}                 & {\cellcolor[HTML]{EFEFEF}1127027.41}              \\
{\color[HTML]{000000}GFlops/Dòllar}               & {\color[HTML]{000000}0.255}                    \\
    \rowcolor[HTML]{EFEFEF}
Power dissipation total (Mega Watts) & 65.692 \\
    Energy efficiency (GFlops/Watt) & 4.374 \\ \hline
\end{tabular}
\caption{Configuració final del clúster.}
\end{center}
\end{adjustwidth}
\end{table}




\subsection{Roofline}


% Please add the following required packages to your document preamble:
% \usepackage{multirow}
%\begin{table}[h]
%\begin{tabular}{lccc|c}
%    \cline{4-5}
%    &                      &      & Bandwith (GB/s)         & Total BW (GB/s)         \\ \cline{4-5} \noalign{\vskip\doublerulesep
%         \vskip--\arrayrulewidth} \hline %\cline{4-5}% \hline \hline
%    \multirow{3}{*}{DRAM}              & \cellcolor[HTML]{EFEFEF}Bits/T               &\cellcolor[HTML]{EFEFEF} 64   & \multirow{3}{*}{\cellcolor[HTML]{EFEFEF}187.06} & \multirow{8}{*}{210.45} \\
%\multicolumn{1}{l|}                                   & GT/s                 & 2.92 &\cellcolor[HTML]{EFEFEF}                         &                         \\
%\multicolumn{1}{l|}                                   & \cellcolor[HTML]{EFEFEF}Channels             & \cellcolor[HTML]{EFEFEF}8    &\cellcolor[HTML]{EFEFEF}                         &                         \\ \cline{1-4}
%\multicolumn{1}{l|}\multirow{3}{*}{Infinity fabric 2} & GT/s                 & 2.92 & \multirow{3}{*}{23.38}  &                         \\
%\multicolumn{1}{l|}                                   & \cellcolor[HTML]{EFEFEF}Effective trans bits & \cellcolor[HTML]{EFEFEF}32   &                         &                         \\
%                                   & Directions           & 2    &                         &                         \\ \cline{1-4}
%\multicolumn{1}{l|}\multirow{2}{*}{PCIe 4.0}          & \cellcolor[HTML]{EFEFEF}Lanes                & \cellcolor[HTML]{EFEFEF}128  & \multirow{2}{*}{256.00} &                         \\
%                                   & GT/s                 & 16   &                         &                         \\ \hline
%\end{tabular}
%\end{table}

% Please add the following required packages to your document preamble:
% \usepackage{multirow}
% \usepackage[table,xcdraw]{xcolor}
% If you use beamer only pass "xcolor=table" option, i.e. \documentclass[xcolor=table]{beamer}
\begin{table}[h]
\begin{tabular}{c|c|c||c|c}
    \hline
Component                           & \multicolumn{2}{c||}{Specifications}                                         & Bandwith (GB/s)          & Total BW (GB/s)          \\ \hline  \hline 
                                    & \cellcolor[HTML]{EFEFEF}bits/T               & \cellcolor[HTML]{EFEFEF}64  &                          &                          \\
                                    & GT/s                                         & 2.922851563                 &                          &                          \\
    \multirow{-3}{*}{DRAM}              & \cellcolor[HTML]{EFEFEF}Channels             & \cellcolor[HTML]{EFEFEF}8   & \multirow{-3}{*}{187.06} &                          \\ \cline{1-4}
                                    & GT/s                                         & 2.922851563                 &                          &                          \\
                                    & \cellcolor[HTML]{EFEFEF}Effective trans bits & \cellcolor[HTML]{EFEFEF}32  &                          &                          \\
    \multirow{-3}{*}{Infinity fabric 2} & Directions                                   & 2                           & \multirow{-3}{*}{23.38}  &                          \\ \cline{1-4}
                                    & \cellcolor[HTML]{EFEFEF}Lanes                & \cellcolor[HTML]{EFEFEF}128 &                          &                          \\
\multirow{-2}{*}{PCIe 4.0}          & GT/s                                         & 16                          & \multirow{-2}{*}{256.00} & \multirow{-8}{*}{210.45} \\ \hline
\end{tabular}
    \caption{Peak bandwidth d'un socket i d'un node.}
    \label{tab:peak_bw}
\end{table}


\begin{table}[h]
\begin{tabular}{c|c|c||c|c|c}
Component                                                                            & \multicolumn{2}{c}{Specs}                                         & GFlops                     & Socket GFlops              & Node GFlops                \\
                                                                                     & \cellcolor[HTML]{EFEFEF}Freq (GHz)  & \cellcolor[HTML]{EFEFEF}2.5 &                            &                            &                            \\
                                                                                     & ops/cycle                           & 16                          &                            &                            &                            \\
\multirow{-3}{*}{AMD EPYC 7502P}                                                     & \cellcolor[HTML]{EFEFEF}\#cores     & \cellcolor[HTML]{EFEFEF}32  & \multirow{-3}{*}{1280}     &                            &                            \\
                                                                                     & FP64 GFlops                         & 6865.92                     &                            &                            &                            \\
\multirow{-2}{*}{\begin{tabular}[c]{@{}c@{}}AMD Radeon\\ Instinct Mi50\end{tabular}} & \cellcolor[HTML]{EFEFEF}GPUs/socket & \cellcolor[HTML]{EFEFEF}4   & \multirow{-2}{*}{27463.68} & \multirow{-5}{*}{28743.68} & \multirow{-5}{*}{57487.36}
\end{tabular}
\end{table}
